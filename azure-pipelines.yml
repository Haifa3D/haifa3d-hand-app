# https://docs.microsoft.com/azure/devops/pipelines/ecosystems/android
pool:
  vmImage: 'ubuntu-latest'

variables:
  DroidDir: '$(System.DefaultWorkingDirectory)/src/android/Haifa3d'

steps:
- task: DotNetCoreCLI@2
  inputs:
    command: custom
    custom: tool
    arguments: install --tool-path . nbgv
  displayName: Install NBGV tool

- script: ./nbgv cloud -c -a
  displayName: Set Version

- task: Gradle@2
  displayName: assembleDebug
  inputs:
    workingDirectory: '$(DroidDir)'
    gradleWrapperFile: '$(DroidDir)/gradlew'
    gradleOptions: '-Xmx3072m'
    publishJUnitResults: false
    testResultsFiles: '**/TEST-*.xml'
    tasks: 'assembleDebug'

- publish: $(DroidDir)/app/build/outputs/apk
  artifact: apk

- task: Gradle@2
  displayName: bundleRelease
  inputs:
    workingDirectory: '$(DroidDir)'
    gradleWrapperFile: '$(DroidDir)/gradlew'
    gradleOptions: '-Xmx3072m'
    publishJUnitResults: false
    testResultsFiles: '**/TEST-*.xml'
    tasks: 'bundleRelease'

- publish: $(DroidDir)/app/build/outputs/bundle/
  artifact: aab